{"title":"Zuul多路径访问时报404问题","date":"2018-09-12T11:05:27.000Z","slug":"Zuul多路径访问时报404问题","tags":["SpringCloud"],"categories":["JAVA"],"updated":"2018-09-12T11:07:58.878Z","content":"<blockquote>\n<p>最近学习SpringCloud过程中发现了一个问题。通过<code>zuul+fegin</code>做路由转发，服务调用的时候，经常会出现404。在单路径下不会出现问题，当我加上多路径例如<code>/user/add</code>，类似这种就会出现404。</p>\n</blockquote>\n<p>最后通过排查发现路径匹配出现的问题，修改成如下即可：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zuul:</span><br><span class=\"line\">  host:</span><br><span class=\"line\">    connect-timeout-millis: <span class=\"number\">60000</span></span><br><span class=\"line\">  routes:</span><br><span class=\"line\">    api-a:</span><br><span class=\"line\">#  ** 可以匹配多个/ xx/xx</span><br><span class=\"line\"># * 仅仅只能匹配单个/xxx</span><br><span class=\"line\">      path: /api-a<span class=\"comment\">/**  </span></span><br><span class=\"line\"><span class=\"comment\">      serviceId: service-ribbon</span></span><br><span class=\"line\"><span class=\"comment\">    api-b:</span></span><br><span class=\"line\"><span class=\"comment\">      path: /api-b/**</span></span><br><span class=\"line\"><span class=\"comment\">      serviceId: service-feign</span></span><br></pre></td></tr></table></figure>\n<p>当然我们还可以为通过设置来决定是否需要zuul给我们提供的前缀路径</p>\n<p>zuul默认给我们如下的跳转规则：</p>\n<p><code>http://localhost:6666/api-a/cc/mm</code> ====》 <code>http://localhost:6666/cc/mm</code></p>\n<p>我们可以通过设置<code>stripPrefix</code>来决定是否需要前缀，<code>true</code>是不加前缀（<code>默认</code>），<code>false</code>就会添加到路径上。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zuul:</span><br><span class=\"line\">  host:</span><br><span class=\"line\">    connect-timeout-millis: <span class=\"number\">60000</span></span><br><span class=\"line\">  routes:</span><br><span class=\"line\">   stripPrefix: <span class=\"keyword\">false</span></span><br><span class=\"line\">    api-a:</span><br><span class=\"line\">      path: /api-a<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">      serviceId: service-ribbon</span></span><br><span class=\"line\"><span class=\"comment\">     # stripPrefix: false</span></span><br></pre></td></tr></table></figure>\n<p>跳转规则如下：</p>\n<p><code>http://localhost:6666/api-a/cc/mm</code>  ====》<code>http://localhost:6666/api-a/cc/mm</code></p>\n","prev":{"title":"Linux下安装部署ActiveMQ","slug":"Linux下安装部署ActiveMQ"},"next":{"title":"hystrix的基本使用","slug":"hystrix的基本使用"},"link":"https://easyhaloo.github.io/post/Zuul多路径访问时报404问题/","copyright":true}